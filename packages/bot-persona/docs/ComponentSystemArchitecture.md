# Архитектура Системы Компонентов BotPersona SDK

Данный документ описывает согласованную архитектуру системы компонентов для BotPersona SDK, основанную на принципах SotaJS и Domain-Driven Design.

## Ключевые Принципы и Роли:

*   **Form (Сущность/Агрегат): Центральная Сущность для Данных Беседы**
    *   `Form` является основной доменной сущностью, которая хранит текущее состояние данных, собираемых в ходе беседы (например, поля профиля пользователя). Она представляет собой чистую структуру данных, не зависящую от способа ее отображения или порядка заполнения.

*   **FSM (Finite State Machine - Конечный Автомат, Value Object): Управление Потоком Беседы**
    *   `FSM` — это неизменяемый Объект-значение, который определяет логику и последовательность шагов в беседе. Он диктует, какое поле или вопрос следует задать следующим, основываясь на текущем состоянии беседы и введенных данных.

*   **ViewMap (Карта Представлений, Value Object): Сопоставление Данных с UI-Компонентами**
    *   `ViewMap` — это неизменяемый Объект-значение, который связывает поля данных из `Form` с конкретными UI-компонентами. Он определяет, какой тип компонента (например, `TextInput`, `SingleChoice`) должен быть использован для отображения или ввода определенного поля.

*   **Stateless-Компоненты: Слой Представления**
    *   UI-компоненты являются "глупыми" (stateless) и чисто презентационными. Они получают все необходимые данные для рендеринга через `props` и не имеют собственного внутреннего состояния или бизнес-логики. Изменение значения в форме приводит к полной перерисовке дерева компонентов.

*   **Use Cases: Оркестраторы**
    *   Use Cases (например, `processUserInput.use-case`) выступают в роли оркестраторов. Они обрабатывают пользовательский ввод, обновляют состояние `Form`, взаимодействуют с `FSM` для определения следующего шага и используют `ViewMap` для выбора подходящего компонента для отображения. Результат операции передается через выходные порты.

*   **Важность Разделения Доменной Логики от Представления**
    *   Архитектура строго разделяет доменную логику (что мы собираем и как управляем потоком) от слоя представления (как это выглядит). Это обеспечивает гибкость, тестируемость и возможность изменения UI без влияния на бизнес-логику.

*   **Zod-схемы для Описания Свойств Компонентов**
    *   Для определения контракта (ожидаемых `props`) каждого типа UI-компонента будут использоваться `zod`-схемы. Это обеспечивает валидацию данных, передаваемых компонентам, и служит источником правды для разработчиков SDK.
