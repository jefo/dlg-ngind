# Чек-лист готовности к реализации: JTBD-квалификатор

Этот документ содержит список требований и решений, которые необходимо принять **перед** началом кодирования `e2e-jtbd-qualifier-bot.ts` на основе улучшенного сценария.

### 1. Логика предварительного расчета

- [ ] **Определить правила расчета:** Нужно создать матрицу или набор правил для генерации вилки цен и сроков. 
  *Пример правила:*
  - **ЕСЛИ** `Job` = "Поддержка (FAQ)" И `Context` = "Telegram" И `FAQ_Count` < 50 **ТО** `Price` = "$500-$800", `Timeline` = "2-3 недели".
  - **ЕСЛИ** `Job` = "Квалификация лидов" И `Context` = "Веб-сайт" И `Integration` = "Да" **ТО** `Price` = "$1500-$2500", `Timeline` = "4-6 недель".

- [ ] **Сформулировать текст вывода:** Подготовить точный текст, который бот будет показывать пользователю, включая дисклеймер о предварительности оценки.

### 2. Логика условных переходов (уточняющие вопросы)

- [ ] **Вопрос о сложности FAQ:**
    - [ ] Сформулировать текст вопроса (например, "Сколько примерно вопросов в вашей базе знаний?").
    - [ ] Определить варианты ответов-кнопок (например, "до 50", "50-200", "200+").

- [ ] **Вопрос о типе интеграции:**
    - [ ] Сформулировать текст вопроса (например, "С какой системой вам требуется интеграция?").
    - [ ] Определить, будет это открытый вопрос или выбор из популярных CRM.

- [ ] **Вопрос про "Другое":**
    - [ ] Сформулировать текст вопроса для уточнения, если пользователь выбрал "Другое" в `Job` или `Context`.

### 3. Проектирование изменений в доменной модели

- [ ] **Обновить `FormDefinition`:**
    - [ ] Добавить новые поля для хранения ответов на уточняющие вопросы (например, `faqCount`, `crmName`, `otherJobDescription`).

- [ ] **Обновить `FSMDefinition`:**
    - [ ] Спроектировать новые состояния для каждого уточняющего вопроса (например, `ask_faq_count`, `ask_crm_name`).
    - [ ] Спроектировать состояние для отображения предварительного расчета (`show_preliminary_estimate`).
    - [ ] Продумать и добавить все новые условные `transitions`.

- [ ] **Обновить `ViewDefinition`:**
    - [ ] Создать `nodes` (тексты и кнопки) для всех новых состояний.
    - [ ] Подготовить `node` для состояния `show_preliminary_estimate` с использованием `context.` для подстановки рассчитанных цен и сроков.

### 4. Поддержка в движке `bot-persona`

- [ ] **Проверить поддержку условных переходов:** Убедиться, что текущая реализация FSM в `Conversation.aggregate` способна обрабатывать переходы, зависящие от данных в `formState` (например, `ЕСЛИ formState.companySize == '200+' ТО перейти в состояние X`). Если нет — спланировать доработку.

--- 

Только после того, как по всем пунктам этого чек-листа будет ясность, можно приступать к написанию кода `e2e-демо`.
